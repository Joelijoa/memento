<div class="note-container">
  <!-- Header avec bouton d'ajout -->
  <div class="note-header">
    <h2>Gestions des Notes</h2>
    <button mat-raised-button color="primary" (click)="openAddNoteDialog()">
      <mat-icon>add</mat-icon>
      Nouvelle Note
    </button>
  </div>

  <!-- Filtres -->
  <mat-card class="filters-card">
    <mat-card-content>
      <div class="filters-row">
        <mat-form-field appearance="outline">
          <mat-label>Type</mat-label>
          <mat-select [(value)]="selectedType" (selectionChange)="filterNotes()">
            <mat-option value="">Tous</mat-option>
            <mat-option value="TEXT">Texte</mat-option>
            <mat-option value="VOICE">Vocal</mat-option>
            <mat-option value="IMAGE">Image</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Rechercher</mat-label>
          <input matInput [(ngModel)]="searchTerm" (ngModelChange)="filterNotes()" placeholder="Titre ou contenu...">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <mat-checkbox [(ngModel)]="showPinnedOnly" (ngModelChange)="filterNotes()">
          Notes épinglées uniquement
        </mat-checkbox>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Liste des notes -->
  <div class="notes-grid">
    <mat-card *ngFor="let note of filteredNotes" class="note-card" [ngClass]="{'pinned': note.isPinned, 'voice-note': note.type === 'VOICE'}">
      <mat-card-header>
        <mat-card-title>
          <mat-icon *ngIf="note.isPinned" class="pin-icon">push_pin</mat-icon>
          {{ note.title }}
        </mat-card-title>
        <mat-card-subtitle>
          <mat-chip-listbox>
            <mat-chip [color]="getTypeColor(note.type)" selected>
              {{ getTypeLabel(note.type) }}
            </mat-chip>
          </mat-chip-listbox>
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content *ngIf="note.content || note.type === 'VOICE'">
        <p class="note-content" *ngIf="note.content">{{ note.content }}</p>
        
        <!-- Lecteur audio pour les notes vocales -->
        <app-audio-player 
          *ngIf="note.type === 'VOICE' && note.mediaPath"
          [audioUrl]="getAudioUrl(note.mediaPath)"
          [fileName]="note.title">
        </app-audio-player>
      </mat-card-content>

      <mat-card-actions align="end">
        <button mat-icon-button (click)="togglePin(note)" matTooltip="Épingler/Désépingler">
          <mat-icon>{{ note.isPinned ? 'push_pin' : 'push_pin_outlined' }}</mat-icon>
        </button>
        
        <button mat-icon-button (click)="editNote(note)" matTooltip="Modifier">
          <mat-icon>edit</mat-icon>
        </button>
        
        <button mat-icon-button (click)="deleteNote(note)" matTooltip="Supprimer" color="warn">
          <mat-icon>delete</mat-icon>
        </button>
      </mat-card-actions>

      <mat-card-footer *ngIf="note.createdAt">
        <small class="note-date">
          Créée le {{ formatDate(note.createdAt) }}
        </small>
      </mat-card-footer>
    </mat-card>
  </div>

  <!-- Message si aucune note -->
  <div *ngIf="filteredNotes.length === 0" class="no-notes">
    <mat-icon>note_add</mat-icon>
    <h3>Aucune note trouvée</h3>
    <p>Commencez par créer votre première note !</p>
  </div>
</div>
